/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * This is a continuation of ngx-popover
 * @Reference {github} https://github.com/pleerock/ngx-popover
 */
import { ChangeDetectorRef, Component, ElementRef, EventEmitter, Input, Renderer2, ViewChild, } from '@angular/core';
import { PopoverPlacement } from './popover.placement';
export class PopoverContentComponent {
    // -------------------------------------------------------------------------
    // Constructor
    // -------------------------------------------------------------------------
    /**
     * @param {?} element
     * @param {?} cdr
     * @param {?} renderer
     */
    constructor(element, cdr, renderer) {
        this.element = element;
        this.cdr = cdr;
        this.renderer = renderer;
        this.placement = PopoverPlacement.Top;
        this.animation = true;
        this.closeOnClickOutside = false;
        this.closeOnMouseOutside = false;
        this.size = 'small';
        this.onCloseFromOutside = new EventEmitter();
        this.top = -10000;
        this.left = -10000;
        this.isIn = false;
        this.displayType = 'none';
        this.opacity = 0;
        this.transitionEnabled = false;
        this.windowWidth = window.innerWidth;
        this.windowHeight = window.innerHeight;
        // -------------------------------------------------------------------------
        // Anonymous
        // -------------------------------------------------------------------------
        /**
         * Closes dropdown if user clicks outside of this directive.
         */
        this.onDocumentMouseDown = (/**
         * @param {?} event
         * @return {?}
         */
        (event) => {
            /** @type {?} */
            const element = this.element.nativeElement;
            if (!element || !this.popover) {
                return;
            }
            if (element.contains(event.target) || this.popover.getElement().contains(event.target)) {
                return;
            }
            this.onCloseFromOutside.emit(undefined);
        });
    }
    // -------------------------------------------------------------------------
    // Lifecycle callbacks
    // -------------------------------------------------------------------------
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        if (this.closeOnClickOutside) {
            this.listenClickFunc = this.renderer.listen('document', 'mousedown', (/**
             * @param {?} event
             * @return {?}
             */
            (event) => this.onDocumentMouseDown(event)));
        }
        if (this.closeOnMouseOutside) {
            this.listenMouseFunc = this.renderer.listen('document', 'mouseover', (/**
             * @param {?} event
             * @return {?}
             */
            (event) => this.onDocumentMouseDown(event)));
        }
        // Always close on mobile touch event outside.
        this.listenTouchFunc = this.renderer.listen('document', 'touchstart', (/**
         * @param {?} event
         * @return {?}
         */
        (event) => this.onDocumentMouseDown(event)));
        this.show();
        this.cdr.detectChanges();
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.closeOnClickOutside && this.listenClickFunc) {
            this.listenClickFunc();
        }
        if (this.closeOnMouseOutside && this.listenMouseFunc) {
            this.listenMouseFunc();
        }
        if (!!this.listenTouchFunc) {
            this.listenTouchFunc();
        }
    }
    // -------------------------------------------------------------------------
    // Public Methods
    // -------------------------------------------------------------------------
    /**
     * @return {?}
     */
    updatePosition() {
        // if visible, reposition
        if (this.opacity) {
            /** @type {?} */
            const p = this.positionElements(this.popover.getElement(), this.popoverDiv.nativeElement, this.placement, this.appendToBody);
            this.top = p.top;
            this.left = p.left;
        }
    }
    /**
     * @return {?}
     */
    show() {
        if (!this.popover || !this.popover.getElement()) {
            return;
        }
        /** @type {?} */
        const p = this.positionElements(this.popover.getElement(), this.popoverDiv.nativeElement, this.placement, this.appendToBody);
        this.displayType = 'block';
        this.top = p.top;
        this.left = p.left;
        this.isIn = true;
        this.transitionEnabled = true;
        this.opacity = 1;
    }
    /**
     * @return {?}
     */
    hide() {
        this.top = -10000;
        this.left = -10000;
        this.isIn = true;
        this.popover.hide();
    }
    /**
     * @return {?}
     */
    hideFromPopover() {
        this.top = -10000;
        this.left = -10000;
        this.isIn = true;
        this.transitionEnabled = false;
        this.opacity = 0;
    }
    // -------------------------------------------------------------------------
    // Protected Methods
    // -------------------------------------------------------------------------
    /**
     * @protected
     * @param {?} hostEl
     * @param {?} targetEl
     * @param {?} positionStr
     * @param {?=} appendToBody
     * @return {?}
     */
    positionElements(hostEl, targetEl, positionStr, appendToBody = false) {
        /** @type {?} */
        const positionStrParts = ((/** @type {?} */ (positionStr))).split(' ');
        /** @type {?} */
        let pos0 = positionStrParts[0];
        /** @type {?} */
        const pos1 = positionStrParts[1] || 'center';
        /** @type {?} */
        const hostElPos = appendToBody ? this.offset(hostEl) : this.position(hostEl);
        /** @type {?} */
        const targetElWidth = targetEl.offsetWidth;
        /** @type {?} */
        const targetElHeight = targetEl.offsetHeight;
        this.effectivePlacement = pos0 = this.getEffectivePlacement(pos0, hostEl, targetEl);
        /** @type {?} */
        const shiftWidth = {
            center: (/**
             * @return {?}
             */
            function () {
                return hostElPos.left + hostElPos.width / 2 - targetElWidth / 2;
            }),
            left: (/**
             * @return {?}
             */
            function () {
                return hostElPos.left;
            }),
            right: (/**
             * @return {?}
             */
            function () {
                return hostElPos.left + hostElPos.width;
            }),
            topOrBottomRight: (/**
             * @return {?}
             */
            function () {
                return hostElPos.left + hostElPos.width / 2;
            }),
            topOrBottomLeft: (/**
             * @return {?}
             */
            function () {
                return hostElPos.left - targetElWidth + hostElPos.width / 2;
            })
        };
        /** @type {?} */
        const shiftHeight = {
            center: (/**
             * @return {?}
             */
            function () {
                return hostElPos.top + hostElPos.height / 2 - targetElHeight / 2;
            }),
            top: (/**
             * @return {?}
             */
            function () {
                return hostElPos.top;
            }),
            bottom: (/**
             * @return {?}
             */
            function () {
                return hostElPos.top + hostElPos.height;
            })
        };
        /** @type {?} */
        let targetElPos;
        switch (pos0) {
            case PopoverPlacement.Right:
                targetElPos = {
                    top: shiftHeight[pos1](),
                    left: shiftWidth[pos0]()
                };
                break;
            case PopoverPlacement.Left:
                targetElPos = {
                    top: shiftHeight[pos1](),
                    left: hostElPos.left - targetElWidth
                };
                break;
            case PopoverPlacement.Bottom:
                targetElPos = {
                    top: shiftHeight[pos0](),
                    left: shiftWidth[pos1]()
                };
                break;
            case PopoverPlacement.TopLeft:
                targetElPos = {
                    top: hostElPos.top - targetElHeight,
                    left: shiftWidth['topOrBottomLeft']()
                };
                break;
            case PopoverPlacement.TopRight:
                targetElPos = {
                    top: hostElPos.top - targetElHeight,
                    left: shiftWidth['topOrBottomRight']()
                };
                break;
            case PopoverPlacement.BottomLeft:
                targetElPos = {
                    top: shiftHeight[PopoverPlacement.Bottom](),
                    left: shiftWidth['topOrBottomLeft']()
                };
                break;
            case PopoverPlacement.BottomRight:
                targetElPos = {
                    top: shiftHeight[PopoverPlacement.Bottom](),
                    left: shiftWidth['topOrBottomRight']()
                };
                break;
            default:
                targetElPos = {
                    top: hostElPos.top - targetElHeight,
                    left: shiftWidth[pos1]()
                };
                break;
        }
        return targetElPos;
    }
    /**
     * @protected
     * @param {?} nativeEl
     * @return {?}
     */
    position(nativeEl) {
        /** @type {?} */
        let offsetParentBCR = { top: 0, left: 0 };
        /** @type {?} */
        const elBCR = this.offset(nativeEl);
        /** @type {?} */
        const offsetParentEl = this.parentOffsetEl(nativeEl);
        if (offsetParentEl !== window.document) {
            offsetParentBCR = this.offset(offsetParentEl);
            offsetParentBCR.top += offsetParentEl.clientTop - offsetParentEl.scrollTop;
            offsetParentBCR.left += offsetParentEl.clientLeft - offsetParentEl.scrollLeft;
        }
        /** @type {?} */
        const boundingClientRect = nativeEl.getBoundingClientRect();
        return {
            width: boundingClientRect.width || nativeEl.offsetWidth,
            height: boundingClientRect.height || nativeEl.offsetHeight,
            top: elBCR.top - offsetParentBCR.top,
            left: elBCR.left - offsetParentBCR.left
        };
    }
    /**
     * @protected
     * @param {?} nativeEl
     * @return {?}
     */
    offset(nativeEl) {
        /** @type {?} */
        const boundingClientRect = nativeEl.getBoundingClientRect();
        return {
            width: boundingClientRect.width || nativeEl.offsetWidth,
            height: boundingClientRect.height || nativeEl.offsetHeight,
            top: boundingClientRect.top + (window.pageYOffset || window.document.documentElement.scrollTop),
            left: boundingClientRect.left + (window.pageXOffset || window.document.documentElement.scrollLeft)
        };
    }
    /**
     * @protected
     * @param {?} nativeEl
     * @param {?} cssProp
     * @return {?}
     */
    getStyle(nativeEl, cssProp) {
        if (((/** @type {?} */ (nativeEl))).currentStyle) { // IE
            return ((/** @type {?} */ (nativeEl))).currentStyle[cssProp];
        }
        if (window.getComputedStyle) {
            return ((/** @type {?} */ (window.getComputedStyle)))(nativeEl)[cssProp];
        }
        // finally try and get inline style
        return ((/** @type {?} */ (nativeEl.style)))[cssProp];
    }
    /**
     * @protected
     * @param {?} nativeEl
     * @return {?}
     */
    isStaticPositioned(nativeEl) {
        return (this.getStyle(nativeEl, 'position') || 'static') === 'static';
    }
    /**
     * @protected
     * @param {?} nativeEl
     * @return {?}
     */
    parentOffsetEl(nativeEl) {
        /** @type {?} */
        let offsetParent = nativeEl.offsetParent || window.document;
        while (offsetParent && offsetParent !== window.document && this.isStaticPositioned(offsetParent)) {
            offsetParent = offsetParent.offsetParent;
        }
        return offsetParent || window.document;
    }
    // Check for overflow of the viewport and reflect the position if necessary.
    /**
     * @protected
     * @param {?} placement
     * @param {?} hostElement
     * @param {?} targetElement
     * @return {?}
     */
    getEffectivePlacement(placement, hostElement, targetElement) {
        /** @type {?} */
        const hostElBoundingRect = hostElement.getBoundingClientRect();
        /** @type {?} */
        const desiredPlacement = placement || PopoverPlacement.Top;
        // Reflect appropriately if overflow.
        if (desiredPlacement === PopoverPlacement.Top) {
            /** @type {?} */
            const isTopOverflow = hostElBoundingRect.top - targetElement.offsetHeight < 0;
            /** @type {?} */
            const isRightOverflow = hostElBoundingRect.left + hostElBoundingRect.width / 2 + targetElement.offsetWidth / 2 > this.windowWidth;
            /** @type {?} */
            const isLeftOverflow = hostElBoundingRect.left + hostElBoundingRect.width / 2 - targetElement.offsetWidth / 2 < 0;
            if (isTopOverflow) {
                return PopoverPlacement.Bottom;
            }
            else if (isRightOverflow) {
                return PopoverPlacement.TopLeft;
            }
            else if (isLeftOverflow) {
                return PopoverPlacement.TopRight;
            }
        }
        if (desiredPlacement === PopoverPlacement.Bottom) {
            /** @type {?} */
            const isRightOverflow = hostElBoundingRect.left + hostElBoundingRect.width / 2 + targetElement.offsetWidth / 2 > this.windowWidth;
            /** @type {?} */
            const isLeftOverflow = hostElBoundingRect.left + hostElBoundingRect.width / 2 - targetElement.offsetWidth / 2 < 0;
            /** @type {?} */
            const isBottomOverflow = hostElBoundingRect.bottom + targetElement.offsetHeight > this.windowHeight;
            if (isBottomOverflow) {
                return PopoverPlacement.Top;
            }
            else if (isRightOverflow) {
                return PopoverPlacement.BottomLeft;
            }
            else if (isLeftOverflow) {
                return PopoverPlacement.BottomRight;
            }
        }
        if (desiredPlacement === PopoverPlacement.Left) {
            /** @type {?} */
            const isTopOverflow = hostElBoundingRect.top + hostElBoundingRect.height / 2 - targetElement.offsetHeight / 2 < 0;
            /** @type {?} */
            const isLeftOverflow = hostElBoundingRect.left - targetElement.offsetWidth < 0;
            /** @type {?} */
            const isBottomOverflow = hostElBoundingRect.top + hostElBoundingRect.height / 2 + targetElement.offsetHeight / 2 > this.windowHeight;
            if (isLeftOverflow) {
                return PopoverPlacement.Right;
            }
            else if (isTopOverflow) {
                return PopoverPlacement.BottomLeft;
            }
            else if (isBottomOverflow) {
                return PopoverPlacement.TopLeft;
            }
        }
        if (desiredPlacement === PopoverPlacement.Right) {
            /** @type {?} */
            const isTopOverflow = hostElBoundingRect.top + hostElBoundingRect.height / 2 - targetElement.offsetHeight / 2 < 0;
            /** @type {?} */
            const isRightOverflow = hostElBoundingRect.right + targetElement.offsetWidth > this.windowWidth;
            /** @type {?} */
            const isBottomOverflow = hostElBoundingRect.top + hostElBoundingRect.height / 2 + targetElement.offsetHeight / 2 > this.windowHeight;
            if (isRightOverflow) {
                return PopoverPlacement.Left;
            }
            else if (isTopOverflow) {
                return PopoverPlacement.BottomRight;
            }
            else if (isBottomOverflow) {
                return PopoverPlacement.TopRight;
            }
        }
        if (desiredPlacement === PopoverPlacement.TopRight) {
            /** @type {?} */
            const isTopOverflow = hostElBoundingRect.top - targetElement.offsetHeight < 0;
            /** @type {?} */
            const isRightOverflow = hostElBoundingRect.right + targetElement.offsetWidth > this.windowWidth;
            if (isTopOverflow && isRightOverflow) {
                return PopoverPlacement.BottomLeft;
            }
            else if (isTopOverflow) {
                return PopoverPlacement.BottomRight;
            }
            else if (isRightOverflow) {
                return PopoverPlacement.TopLeft;
            }
        }
        if (desiredPlacement === PopoverPlacement.TopLeft) {
            /** @type {?} */
            const isTopOverflow = hostElBoundingRect.top - targetElement.offsetHeight < 0;
            /** @type {?} */
            const isLeftOverflow = hostElBoundingRect.left - targetElement.offsetWidth < 0;
            if (isTopOverflow && isLeftOverflow) {
                return PopoverPlacement.BottomRight;
            }
            else if (isTopOverflow) {
                return PopoverPlacement.BottomLeft;
            }
            else if (isLeftOverflow) {
                return PopoverPlacement.TopRight;
            }
        }
        if (desiredPlacement === PopoverPlacement.BottomRight) {
            /** @type {?} */
            const isBottomOverflow = hostElBoundingRect.bottom + targetElement.offsetHeight > this.windowHeight;
            /** @type {?} */
            const isRightOverflow = hostElBoundingRect.right + targetElement.offsetWidth > this.windowWidth;
            if (isBottomOverflow && isRightOverflow) {
                return PopoverPlacement.TopLeft;
            }
            else if (isBottomOverflow) {
                return PopoverPlacement.TopRight;
            }
            else if (isRightOverflow) {
                return PopoverPlacement.BottomLeft;
            }
        }
        if (desiredPlacement === PopoverPlacement.BottomLeft) {
            /** @type {?} */
            const isBottomOverflow = hostElBoundingRect.bottom + targetElement.offsetHeight > this.windowHeight;
            /** @type {?} */
            const isLeftOverflow = hostElBoundingRect.left - targetElement.offsetWidth < 0;
            if (isBottomOverflow && isLeftOverflow) {
                return PopoverPlacement.TopRight;
            }
            else if (isBottomOverflow) {
                return PopoverPlacement.TopLeft;
            }
            else if (isLeftOverflow) {
                return PopoverPlacement.BottomRight;
            }
        }
        return desiredPlacement;
    }
}
PopoverContentComponent.decorators = [
    { type: Component, args: [{
                selector: 'popover-content',
                template: `
    <div #popoverDiv
        class="bs-popover-{{ effectivePlacement }} popover-content popover {{ parentClass }}"
        [ngClass]="{
            'sm': size === 'small',
            'md-sm': size === 'medium-small',
            'md': size === 'medium',
            'lg': size === 'large'
        }"
        [style.top.px]="top"
        [style.left.px]="left"
        [style.transition]="(transitionEnabled ? '0.15s opacity' : '')"
        [style.opacity]="opacity"
        [style.display]="'block'"
        [class.in]="isIn"
        role="popover">
            <div [hidden]="!closeOnMouseOutside" class="virtual-area"></div>
            <div class="arrow"></div>
            <div class="popover-header" [hidden]="!title">{{ title }}</div>
            <div class="popover-body">
                <ng-content></ng-content>
                {{ content }}
            </div>
    </div>
    `
            }] }
];
/** @nocollapse */
PopoverContentComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: ChangeDetectorRef },
    { type: Renderer2 }
];
PopoverContentComponent.propDecorators = {
    content: [{ type: Input }],
    placement: [{ type: Input }],
    title: [{ type: Input }],
    parentClass: [{ type: Input }],
    animation: [{ type: Input }],
    closeOnClickOutside: [{ type: Input }],
    closeOnMouseOutside: [{ type: Input }],
    appendToBody: [{ type: Input }],
    size: [{ type: Input }],
    popoverDiv: [{ type: ViewChild, args: ['popoverDiv',] }]
};
if (false) {
    /** @type {?} */
    PopoverContentComponent.prototype.content;
    /** @type {?} */
    PopoverContentComponent.prototype.placement;
    /** @type {?} */
    PopoverContentComponent.prototype.title;
    /** @type {?} */
    PopoverContentComponent.prototype.parentClass;
    /** @type {?} */
    PopoverContentComponent.prototype.animation;
    /** @type {?} */
    PopoverContentComponent.prototype.closeOnClickOutside;
    /** @type {?} */
    PopoverContentComponent.prototype.closeOnMouseOutside;
    /** @type {?} */
    PopoverContentComponent.prototype.appendToBody;
    /** @type {?} */
    PopoverContentComponent.prototype.size;
    /** @type {?} */
    PopoverContentComponent.prototype.popoverDiv;
    /** @type {?} */
    PopoverContentComponent.prototype.popover;
    /** @type {?} */
    PopoverContentComponent.prototype.onCloseFromOutside;
    /** @type {?} */
    PopoverContentComponent.prototype.top;
    /** @type {?} */
    PopoverContentComponent.prototype.left;
    /** @type {?} */
    PopoverContentComponent.prototype.isIn;
    /** @type {?} */
    PopoverContentComponent.prototype.displayType;
    /** @type {?} */
    PopoverContentComponent.prototype.effectivePlacement;
    /** @type {?} */
    PopoverContentComponent.prototype.opacity;
    /** @type {?} */
    PopoverContentComponent.prototype.transitionEnabled;
    /** @type {?} */
    PopoverContentComponent.prototype.windowWidth;
    /** @type {?} */
    PopoverContentComponent.prototype.windowHeight;
    /** @type {?} */
    PopoverContentComponent.prototype.listenClickFunc;
    /** @type {?} */
    PopoverContentComponent.prototype.listenMouseFunc;
    /** @type {?} */
    PopoverContentComponent.prototype.listenTouchFunc;
    /**
     * Closes dropdown if user clicks outside of this directive.
     * @type {?}
     */
    PopoverContentComponent.prototype.onDocumentMouseDown;
    /**
     * @type {?}
     * @protected
     */
    PopoverContentComponent.prototype.element;
    /**
     * @type {?}
     * @protected
     */
    PopoverContentComponent.prototype.cdr;
    /**
     * @type {?}
     * @protected
     */
    PopoverContentComponent.prototype.renderer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9wb3Zlci1jb250ZW50LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1zbWFydC1wb3BvdmVyLXB4LyIsInNvdXJjZXMiOlsibGliL3BvcG92ZXItY29udGVudC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFLQSxPQUFPLEVBRUgsaUJBQWlCLEVBQ2pCLFNBQVMsRUFDVCxVQUFVLEVBQ1YsWUFBWSxFQUNaLEtBQUssRUFFTCxTQUFTLEVBQ1QsU0FBUyxHQUNaLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBOEJ2RCxNQUFNLE9BQU8sdUJBQXVCOzs7Ozs7Ozs7SUEwRGxDLFlBQXNCLE9BQW1CLEVBQ25CLEdBQXNCLEVBQ3RCLFFBQW1CO1FBRm5CLFlBQU8sR0FBUCxPQUFPLENBQVk7UUFDbkIsUUFBRyxHQUFILEdBQUcsQ0FBbUI7UUFDdEIsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQXZEekIsY0FBUyxHQUFxQixnQkFBZ0IsQ0FBQyxHQUFHLENBQUM7UUFHbkQsY0FBUyxHQUFHLElBQUksQ0FBQztRQUNqQix3QkFBbUIsR0FBRyxLQUFLLENBQUM7UUFDNUIsd0JBQW1CLEdBQUcsS0FBSyxDQUFDO1FBRTVCLFNBQUksR0FBMkQsT0FBTyxDQUFDO1FBUWhGLHVCQUFrQixHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDeEMsUUFBRyxHQUFHLENBQUMsS0FBSyxDQUFDO1FBQ2IsU0FBSSxHQUFHLENBQUMsS0FBSyxDQUFDO1FBQ2QsU0FBSSxHQUFHLEtBQUssQ0FBQztRQUNiLGdCQUFXLEdBQUcsTUFBTSxDQUFDO1FBRXJCLFlBQU8sR0FBRyxDQUFDLENBQUM7UUFDWixzQkFBaUIsR0FBRyxLQUFLLENBQUM7UUFFMUIsZ0JBQVcsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDO1FBQ2hDLGlCQUFZLEdBQUcsTUFBTSxDQUFDLFdBQVcsQ0FBQzs7Ozs7OztRQWFsQyx3QkFBbUI7Ozs7UUFBRyxDQUFDLEtBQVUsRUFBRSxFQUFFOztrQkFDbEMsT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYTtZQUMxQyxJQUFJLENBQUMsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRTtnQkFDM0IsT0FBTzthQUNWO1lBQ0QsSUFBSSxPQUFPLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUU7Z0JBQ3BGLE9BQU87YUFDVjtZQUNELElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDNUMsQ0FBQyxFQUFBO0lBU0QsQ0FBQzs7Ozs7OztJQU1NLGVBQWU7UUFDbEIsSUFBSSxJQUFJLENBQUMsbUJBQW1CLEVBQUU7WUFDMUIsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsV0FBVzs7OztZQUFFLENBQUMsS0FBVSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsS0FBSyxDQUFDLEVBQUMsQ0FBQztTQUN6SDtRQUNELElBQUksSUFBSSxDQUFDLG1CQUFtQixFQUFFO1lBQzFCLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsVUFBVSxFQUFFLFdBQVc7Ozs7WUFBRSxDQUFDLEtBQVUsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLEtBQUssQ0FBQyxFQUFDLENBQUM7U0FDekg7UUFDRCw4Q0FBOEM7UUFDOUMsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsWUFBWTs7OztRQUFFLENBQUMsS0FBVSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsS0FBSyxDQUFDLEVBQUMsQ0FBQztRQUV2SCxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDWixJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQzdCLENBQUM7Ozs7SUFFTSxXQUFXO1FBQ2QsSUFBSSxJQUFJLENBQUMsbUJBQW1CLElBQUksSUFBSSxDQUFDLGVBQWUsRUFBRTtZQUNsRCxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7U0FDMUI7UUFDRCxJQUFJLElBQUksQ0FBQyxtQkFBbUIsSUFBSSxJQUFJLENBQUMsZUFBZSxFQUFFO1lBQ2xELElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztTQUMxQjtRQUNELElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUU7WUFDeEIsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1NBQzFCO0lBQ0wsQ0FBQzs7Ozs7OztJQU1NLGNBQWM7UUFDakIseUJBQXlCO1FBQ3pCLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTs7a0JBQ1IsQ0FBQyxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLFlBQVksQ0FBQztZQUM1SCxJQUFJLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUM7WUFDakIsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO1NBQ3RCO0lBQ0wsQ0FBQzs7OztJQUVNLElBQUk7UUFDUCxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLEVBQUU7WUFDN0MsT0FBTztTQUNWOztjQUVLLENBQUMsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUUsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxZQUFZLENBQUM7UUFDNUgsSUFBSSxDQUFDLFdBQVcsR0FBRyxPQUFPLENBQUM7UUFDM0IsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDO1FBQ2pCLElBQUksQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUNuQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUNqQixJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDO1FBQzlCLElBQUksQ0FBQyxPQUFPLEdBQUcsQ0FBQyxDQUFDO0lBQ3JCLENBQUM7Ozs7SUFFTSxJQUFJO1FBQ1AsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQztRQUNsQixJQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFDO1FBQ25CLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2pCLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDeEIsQ0FBQzs7OztJQUVNLGVBQWU7UUFDbEIsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQztRQUNsQixJQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFDO1FBQ25CLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2pCLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxLQUFLLENBQUM7UUFDL0IsSUFBSSxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQUM7SUFDckIsQ0FBQzs7Ozs7Ozs7Ozs7O0lBTVMsZ0JBQWdCLENBQUMsTUFBbUIsRUFBRSxRQUFxQixFQUFFLFdBQTZCLEVBQUUsZUFBd0IsS0FBSzs7Y0FDekgsZ0JBQWdCLEdBQUcsQ0FBQyxtQkFBQSxXQUFXLEVBQVUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUM7O1lBQ3ZELElBQUksR0FBRyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUM7O2NBQ3hCLElBQUksR0FBRyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsSUFBSSxRQUFROztjQUN0QyxTQUFTLEdBQUcsWUFBWSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQzs7Y0FDdEUsYUFBYSxHQUFHLFFBQVEsQ0FBQyxXQUFXOztjQUNwQyxjQUFjLEdBQUcsUUFBUSxDQUFDLFlBQVk7UUFFNUMsSUFBSSxDQUFDLGtCQUFrQixHQUFHLElBQUksR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsSUFBSSxFQUFFLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQzs7Y0FFOUUsVUFBVSxHQUFRO1lBQ3BCLE1BQU07OztZQUFFO2dCQUNKLE9BQU8sU0FBUyxDQUFDLElBQUksR0FBRyxTQUFTLENBQUMsS0FBSyxHQUFHLENBQUMsR0FBRyxhQUFhLEdBQUcsQ0FBQyxDQUFDO1lBQ3BFLENBQUMsQ0FBQTtZQUNELElBQUk7OztZQUFFO2dCQUNGLE9BQU8sU0FBUyxDQUFDLElBQUksQ0FBQztZQUMxQixDQUFDLENBQUE7WUFDRCxLQUFLOzs7WUFBRTtnQkFDSCxPQUFPLFNBQVMsQ0FBQyxJQUFJLEdBQUcsU0FBUyxDQUFDLEtBQUssQ0FBQztZQUM1QyxDQUFDLENBQUE7WUFDRCxnQkFBZ0I7OztZQUFFO2dCQUNkLE9BQU8sU0FBUyxDQUFDLElBQUksR0FBRyxTQUFTLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztZQUNoRCxDQUFDLENBQUE7WUFDRCxlQUFlOzs7WUFBRTtnQkFDYixPQUFPLFNBQVMsQ0FBQyxJQUFJLEdBQUcsYUFBYSxHQUFJLFNBQVMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO1lBQ2pFLENBQUMsQ0FBQTtTQUNKOztjQUVLLFdBQVcsR0FBUTtZQUNyQixNQUFNOzs7WUFBRTtnQkFDSixPQUFPLFNBQVMsQ0FBQyxHQUFHLEdBQUcsU0FBUyxDQUFDLE1BQU0sR0FBRyxDQUFDLEdBQUcsY0FBYyxHQUFHLENBQUMsQ0FBQztZQUNyRSxDQUFDLENBQUE7WUFDRCxHQUFHOzs7WUFBRTtnQkFDRCxPQUFPLFNBQVMsQ0FBQyxHQUFHLENBQUM7WUFDekIsQ0FBQyxDQUFBO1lBQ0QsTUFBTTs7O1lBQUU7Z0JBQ0osT0FBTyxTQUFTLENBQUMsR0FBRyxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQUM7WUFDNUMsQ0FBQyxDQUFBO1NBQ0o7O1lBRUcsV0FBMEM7UUFDOUMsUUFBUSxJQUFJLEVBQUU7WUFDVixLQUFLLGdCQUFnQixDQUFDLEtBQUs7Z0JBQ3ZCLFdBQVcsR0FBRztvQkFDVixHQUFHLEVBQUUsV0FBVyxDQUFDLElBQUksQ0FBQyxFQUFFO29CQUN4QixJQUFJLEVBQUUsVUFBVSxDQUFDLElBQUksQ0FBQyxFQUFFO2lCQUMzQixDQUFDO2dCQUNGLE1BQU07WUFFVixLQUFLLGdCQUFnQixDQUFDLElBQUk7Z0JBQ3RCLFdBQVcsR0FBRztvQkFDVixHQUFHLEVBQUUsV0FBVyxDQUFDLElBQUksQ0FBQyxFQUFFO29CQUN4QixJQUFJLEVBQUUsU0FBUyxDQUFDLElBQUksR0FBRyxhQUFhO2lCQUN2QyxDQUFDO2dCQUNGLE1BQU07WUFFVixLQUFLLGdCQUFnQixDQUFDLE1BQU07Z0JBQ3hCLFdBQVcsR0FBRztvQkFDVixHQUFHLEVBQUUsV0FBVyxDQUFDLElBQUksQ0FBQyxFQUFFO29CQUN4QixJQUFJLEVBQUUsVUFBVSxDQUFDLElBQUksQ0FBQyxFQUFFO2lCQUMzQixDQUFDO2dCQUNGLE1BQU07WUFDVixLQUFLLGdCQUFnQixDQUFDLE9BQU87Z0JBQ3pCLFdBQVcsR0FBRztvQkFDVixHQUFHLEVBQUUsU0FBUyxDQUFDLEdBQUcsR0FBRyxjQUFjO29CQUNuQyxJQUFJLEVBQUUsVUFBVSxDQUFDLGlCQUFpQixDQUFDLEVBQUU7aUJBQ3hDLENBQUM7Z0JBQ0YsTUFBTTtZQUNWLEtBQUssZ0JBQWdCLENBQUMsUUFBUTtnQkFDMUIsV0FBVyxHQUFHO29CQUNWLEdBQUcsRUFBRSxTQUFTLENBQUMsR0FBRyxHQUFHLGNBQWM7b0JBQ25DLElBQUksRUFBRSxVQUFVLENBQUMsa0JBQWtCLENBQUMsRUFBRTtpQkFDekMsQ0FBQztnQkFDRixNQUFNO1lBQ1YsS0FBSyxnQkFBZ0IsQ0FBQyxVQUFVO2dCQUM1QixXQUFXLEdBQUc7b0JBQ1YsR0FBRyxFQUFFLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsRUFBRTtvQkFDM0MsSUFBSSxFQUFFLFVBQVUsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFO2lCQUN4QyxDQUFDO2dCQUNGLE1BQU07WUFDVixLQUFLLGdCQUFnQixDQUFDLFdBQVc7Z0JBQzdCLFdBQVcsR0FBRztvQkFDVixHQUFHLEVBQUUsV0FBVyxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxFQUFFO29CQUMzQyxJQUFJLEVBQUUsVUFBVSxDQUFDLGtCQUFrQixDQUFDLEVBQUU7aUJBQ3pDLENBQUM7Z0JBQ0YsTUFBTTtZQUVWO2dCQUNJLFdBQVcsR0FBRztvQkFDVixHQUFHLEVBQUUsU0FBUyxDQUFDLEdBQUcsR0FBRyxjQUFjO29CQUNuQyxJQUFJLEVBQUUsVUFBVSxDQUFDLElBQUksQ0FBQyxFQUFFO2lCQUMzQixDQUFDO2dCQUNGLE1BQU07U0FDYjtRQUVELE9BQU8sV0FBVyxDQUFDO0lBQ3ZCLENBQUM7Ozs7OztJQUVTLFFBQVEsQ0FBQyxRQUFxQjs7WUFDaEMsZUFBZSxHQUFHLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFOztjQUNuQyxLQUFLLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUM7O2NBQzdCLGNBQWMsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQztRQUNwRCxJQUFJLGNBQWMsS0FBSyxNQUFNLENBQUMsUUFBUSxFQUFFO1lBQ3BDLGVBQWUsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1lBQzlDLGVBQWUsQ0FBQyxHQUFHLElBQUksY0FBYyxDQUFDLFNBQVMsR0FBRyxjQUFjLENBQUMsU0FBUyxDQUFDO1lBQzNFLGVBQWUsQ0FBQyxJQUFJLElBQUksY0FBYyxDQUFDLFVBQVUsR0FBRyxjQUFjLENBQUMsVUFBVSxDQUFDO1NBQ2pGOztjQUVLLGtCQUFrQixHQUFHLFFBQVEsQ0FBQyxxQkFBcUIsRUFBRTtRQUMzRCxPQUFPO1lBQ0gsS0FBSyxFQUFFLGtCQUFrQixDQUFDLEtBQUssSUFBSSxRQUFRLENBQUMsV0FBVztZQUN2RCxNQUFNLEVBQUUsa0JBQWtCLENBQUMsTUFBTSxJQUFJLFFBQVEsQ0FBQyxZQUFZO1lBQzFELEdBQUcsRUFBRSxLQUFLLENBQUMsR0FBRyxHQUFHLGVBQWUsQ0FBQyxHQUFHO1lBQ3BDLElBQUksRUFBRSxLQUFLLENBQUMsSUFBSSxHQUFHLGVBQWUsQ0FBQyxJQUFJO1NBQzFDLENBQUM7SUFDTixDQUFDOzs7Ozs7SUFFUyxNQUFNLENBQUMsUUFBYTs7Y0FDcEIsa0JBQWtCLEdBQUcsUUFBUSxDQUFDLHFCQUFxQixFQUFFO1FBQzNELE9BQU87WUFDSCxLQUFLLEVBQUUsa0JBQWtCLENBQUMsS0FBSyxJQUFJLFFBQVEsQ0FBQyxXQUFXO1lBQ3ZELE1BQU0sRUFBRSxrQkFBa0IsQ0FBQyxNQUFNLElBQUksUUFBUSxDQUFDLFlBQVk7WUFDMUQsR0FBRyxFQUFFLGtCQUFrQixDQUFDLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxXQUFXLElBQUksTUFBTSxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsU0FBUyxDQUFDO1lBQy9GLElBQUksRUFBRSxrQkFBa0IsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxNQUFNLENBQUMsV0FBVyxJQUFJLE1BQU0sQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDLFVBQVUsQ0FBQztTQUNyRyxDQUFDO0lBQ04sQ0FBQzs7Ozs7OztJQUVTLFFBQVEsQ0FBQyxRQUFxQixFQUFFLE9BQWU7UUFDckQsSUFBSSxDQUFDLG1CQUFBLFFBQVEsRUFBTyxDQUFDLENBQUMsWUFBWSxFQUFFLEVBQUUsS0FBSztZQUN2QyxPQUFPLENBQUMsbUJBQUEsUUFBUSxFQUFPLENBQUMsQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUM7U0FDbEQ7UUFFRCxJQUFJLE1BQU0sQ0FBQyxnQkFBZ0IsRUFBRTtZQUN6QixPQUFPLENBQUMsbUJBQUEsTUFBTSxDQUFDLGdCQUFnQixFQUFPLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUM5RDtRQUVELG1DQUFtQztRQUNuQyxPQUFPLENBQUMsbUJBQUEsUUFBUSxDQUFDLEtBQUssRUFBTyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDNUMsQ0FBQzs7Ozs7O0lBRVMsa0JBQWtCLENBQUMsUUFBcUI7UUFDOUMsT0FBTyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLFVBQVUsQ0FBQyxJQUFJLFFBQVEsQ0FBRSxLQUFLLFFBQVEsQ0FBQztJQUMzRSxDQUFDOzs7Ozs7SUFFUyxjQUFjLENBQUMsUUFBcUI7O1lBQ3RDLFlBQVksR0FBUSxRQUFRLENBQUMsWUFBWSxJQUFJLE1BQU0sQ0FBQyxRQUFRO1FBQ2hFLE9BQU8sWUFBWSxJQUFJLFlBQVksS0FBSyxNQUFNLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxZQUFZLENBQUMsRUFBRTtZQUM5RixZQUFZLEdBQUcsWUFBWSxDQUFDLFlBQVksQ0FBQztTQUM1QztRQUNELE9BQU8sWUFBWSxJQUFJLE1BQU0sQ0FBQyxRQUFRLENBQUM7SUFDM0MsQ0FBQzs7Ozs7Ozs7O0lBR1MscUJBQXFCLENBQUMsU0FBaUIsRUFBRSxXQUF3QixFQUFFLGFBQTBCOztjQUM3RixrQkFBa0IsR0FBRyxXQUFXLENBQUMscUJBQXFCLEVBQUU7O2NBRXhELGdCQUFnQixHQUFHLFNBQVMsSUFBSSxnQkFBZ0IsQ0FBQyxHQUFHO1FBRTFELHFDQUFxQztRQUNyQyxJQUFJLGdCQUFnQixLQUFLLGdCQUFnQixDQUFDLEdBQUcsRUFBRTs7a0JBQ3JDLGFBQWEsR0FBRyxrQkFBa0IsQ0FBQyxHQUFHLEdBQUcsYUFBYSxDQUFDLFlBQVksR0FBRyxDQUFDOztrQkFDdkUsZUFBZSxHQUFHLGtCQUFrQixDQUFDLElBQUksR0FBRyxrQkFBa0IsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxHQUFHLGFBQWEsQ0FBQyxXQUFXLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxXQUFXOztrQkFDM0gsY0FBYyxHQUFHLGtCQUFrQixDQUFDLElBQUksR0FBRyxrQkFBa0IsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxHQUFHLGFBQWEsQ0FBQyxXQUFXLEdBQUcsQ0FBQyxHQUFHLENBQUM7WUFFakgsSUFBSSxhQUFhLEVBQUU7Z0JBQ2YsT0FBTyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUM7YUFDbEM7aUJBQU0sSUFBSSxlQUFlLEVBQUU7Z0JBQ3hCLE9BQU8sZ0JBQWdCLENBQUMsT0FBTyxDQUFDO2FBQ25DO2lCQUFNLElBQUksY0FBYyxFQUFFO2dCQUN2QixPQUFPLGdCQUFnQixDQUFDLFFBQVEsQ0FBQzthQUNwQztTQUNKO1FBQ0QsSUFBSSxnQkFBZ0IsS0FBSyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUU7O2tCQUN4QyxlQUFlLEdBQUcsa0JBQWtCLENBQUMsSUFBSSxHQUFHLGtCQUFrQixDQUFDLEtBQUssR0FBRyxDQUFDLEdBQUcsYUFBYSxDQUFDLFdBQVcsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLFdBQVc7O2tCQUMzSCxjQUFjLEdBQUcsa0JBQWtCLENBQUMsSUFBSSxHQUFHLGtCQUFrQixDQUFDLEtBQUssR0FBRyxDQUFDLEdBQUcsYUFBYSxDQUFDLFdBQVcsR0FBRyxDQUFDLEdBQUcsQ0FBQzs7a0JBQzNHLGdCQUFnQixHQUFHLGtCQUFrQixDQUFDLE1BQU0sR0FBRyxhQUFhLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxZQUFZO1lBRW5HLElBQUksZ0JBQWdCLEVBQUU7Z0JBQ2xCLE9BQU8sZ0JBQWdCLENBQUMsR0FBRyxDQUFDO2FBQy9CO2lCQUFNLElBQUksZUFBZSxFQUFFO2dCQUN4QixPQUFPLGdCQUFnQixDQUFDLFVBQVUsQ0FBQzthQUN0QztpQkFBTSxJQUFJLGNBQWMsRUFBRTtnQkFDdkIsT0FBTyxnQkFBZ0IsQ0FBQyxXQUFXLENBQUM7YUFDdkM7U0FDSjtRQUNELElBQUksZ0JBQWdCLEtBQUssZ0JBQWdCLENBQUMsSUFBSSxFQUFFOztrQkFDdEMsYUFBYSxHQUFHLGtCQUFrQixDQUFDLEdBQUcsR0FBRyxrQkFBa0IsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxHQUFHLGFBQWEsQ0FBQyxZQUFZLEdBQUcsQ0FBQyxHQUFHLENBQUM7O2tCQUMzRyxjQUFjLEdBQUcsa0JBQWtCLENBQUMsSUFBSSxHQUFHLGFBQWEsQ0FBQyxXQUFXLEdBQUcsQ0FBQzs7a0JBQ3hFLGdCQUFnQixHQUFHLGtCQUFrQixDQUFDLEdBQUcsR0FBRyxrQkFBa0IsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxHQUFHLGFBQWEsQ0FBQyxZQUFZLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxZQUFZO1lBRXBJLElBQUksY0FBYyxFQUFFO2dCQUNoQixPQUFPLGdCQUFnQixDQUFDLEtBQUssQ0FBQzthQUNqQztpQkFBTSxJQUFJLGFBQWEsRUFBRTtnQkFDdEIsT0FBTyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUM7YUFDdEM7aUJBQU0sSUFBSSxnQkFBZ0IsRUFBRTtnQkFDekIsT0FBTyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUM7YUFDbkM7U0FDSjtRQUNELElBQUksZ0JBQWdCLEtBQUssZ0JBQWdCLENBQUMsS0FBSyxFQUFFOztrQkFDdkMsYUFBYSxHQUFHLGtCQUFrQixDQUFDLEdBQUcsR0FBRyxrQkFBa0IsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxHQUFHLGFBQWEsQ0FBQyxZQUFZLEdBQUcsQ0FBQyxHQUFHLENBQUM7O2tCQUMzRyxlQUFlLEdBQUcsa0JBQWtCLENBQUMsS0FBSyxHQUFHLGFBQWEsQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFdBQVc7O2tCQUN6RixnQkFBZ0IsR0FBRyxrQkFBa0IsQ0FBQyxHQUFHLEdBQUcsa0JBQWtCLENBQUMsTUFBTSxHQUFHLENBQUMsR0FBRyxhQUFhLENBQUMsWUFBWSxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsWUFBWTtZQUVwSSxJQUFJLGVBQWUsRUFBRTtnQkFDakIsT0FBTyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUM7YUFDaEM7aUJBQU0sSUFBSSxhQUFhLEVBQUU7Z0JBQ3RCLE9BQU8sZ0JBQWdCLENBQUMsV0FBVyxDQUFDO2FBQ3ZDO2lCQUFNLElBQUksZ0JBQWdCLEVBQUU7Z0JBQ3pCLE9BQU8sZ0JBQWdCLENBQUMsUUFBUSxDQUFDO2FBQ3BDO1NBQ0o7UUFDRCxJQUFJLGdCQUFnQixLQUFLLGdCQUFnQixDQUFDLFFBQVEsRUFBRTs7a0JBQzFDLGFBQWEsR0FBRyxrQkFBa0IsQ0FBQyxHQUFHLEdBQUcsYUFBYSxDQUFDLFlBQVksR0FBRyxDQUFDOztrQkFDdkUsZUFBZSxHQUFHLGtCQUFrQixDQUFDLEtBQUssR0FBRyxhQUFhLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXO1lBRS9GLElBQUksYUFBYSxJQUFJLGVBQWUsRUFBRTtnQkFDbEMsT0FBTyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUM7YUFDdEM7aUJBQU0sSUFBSSxhQUFhLEVBQUU7Z0JBQ3RCLE9BQU8sZ0JBQWdCLENBQUMsV0FBVyxDQUFDO2FBQ3ZDO2lCQUFNLElBQUksZUFBZSxFQUFFO2dCQUN4QixPQUFPLGdCQUFnQixDQUFDLE9BQU8sQ0FBQzthQUNuQztTQUNKO1FBQ0QsSUFBSSxnQkFBZ0IsS0FBSyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUU7O2tCQUN6QyxhQUFhLEdBQUcsa0JBQWtCLENBQUMsR0FBRyxHQUFHLGFBQWEsQ0FBQyxZQUFZLEdBQUcsQ0FBQzs7a0JBQ3ZFLGNBQWMsR0FBRyxrQkFBa0IsQ0FBQyxJQUFJLEdBQUcsYUFBYSxDQUFDLFdBQVcsR0FBRyxDQUFDO1lBRTlFLElBQUksYUFBYSxJQUFJLGNBQWMsRUFBRTtnQkFDakMsT0FBTyxnQkFBZ0IsQ0FBQyxXQUFXLENBQUM7YUFDdkM7aUJBQU0sSUFBSSxhQUFhLEVBQUU7Z0JBQ3RCLE9BQU8sZ0JBQWdCLENBQUMsVUFBVSxDQUFDO2FBQ3RDO2lCQUFNLElBQUksY0FBYyxFQUFFO2dCQUN2QixPQUFPLGdCQUFnQixDQUFDLFFBQVEsQ0FBQzthQUNwQztTQUNKO1FBQ0QsSUFBSSxnQkFBZ0IsS0FBSyxnQkFBZ0IsQ0FBQyxXQUFXLEVBQUU7O2tCQUM3QyxnQkFBZ0IsR0FBRyxrQkFBa0IsQ0FBQyxNQUFNLEdBQUcsYUFBYSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsWUFBWTs7a0JBQzdGLGVBQWUsR0FBRyxrQkFBa0IsQ0FBQyxLQUFLLEdBQUcsYUFBYSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsV0FBVztZQUUvRixJQUFJLGdCQUFnQixJQUFJLGVBQWUsRUFBRTtnQkFDckMsT0FBTyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUM7YUFDbkM7aUJBQU0sSUFBSSxnQkFBZ0IsRUFBRTtnQkFDekIsT0FBTyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUM7YUFDcEM7aUJBQU0sSUFBSSxlQUFlLEVBQUU7Z0JBQ3hCLE9BQU8sZ0JBQWdCLENBQUMsVUFBVSxDQUFDO2FBQ3RDO1NBQ0o7UUFDRCxJQUFJLGdCQUFnQixLQUFLLGdCQUFnQixDQUFDLFVBQVUsRUFBRTs7a0JBQzVDLGdCQUFnQixHQUFHLGtCQUFrQixDQUFDLE1BQU0sR0FBRyxhQUFhLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxZQUFZOztrQkFDN0YsY0FBYyxHQUFHLGtCQUFrQixDQUFDLElBQUksR0FBRyxhQUFhLENBQUMsV0FBVyxHQUFHLENBQUM7WUFFOUUsSUFBSSxnQkFBZ0IsSUFBSSxjQUFjLEVBQUU7Z0JBQ3BDLE9BQU8sZ0JBQWdCLENBQUMsUUFBUSxDQUFDO2FBQ3BDO2lCQUFNLElBQUksZ0JBQWdCLEVBQUU7Z0JBQ3pCLE9BQU8sZ0JBQWdCLENBQUMsT0FBTyxDQUFDO2FBQ25DO2lCQUFNLElBQUksY0FBYyxFQUFFO2dCQUN2QixPQUFPLGdCQUFnQixDQUFDLFdBQVcsQ0FBQzthQUN2QztTQUNKO1FBRUQsT0FBTyxnQkFBZ0IsQ0FBQztJQUM1QixDQUFDOzs7WUE1YUYsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxpQkFBaUI7Z0JBQzNCLFFBQVEsRUFBRTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0tBd0JQO2FBQ0o7Ozs7WUFyQ0csVUFBVTtZQUZWLGlCQUFpQjtZQU1qQixTQUFTOzs7c0JBc0NWLEtBQUs7d0JBQ0wsS0FBSztvQkFDTCxLQUFLOzBCQUNMLEtBQUs7d0JBQ0wsS0FBSztrQ0FDTCxLQUFLO2tDQUNMLEtBQUs7MkJBQ0wsS0FBSzttQkFDTCxLQUFLO3lCQUtMLFNBQVMsU0FBQyxZQUFZOzs7O0lBYnZCLDBDQUFnQzs7SUFDaEMsNENBQW1FOztJQUNuRSx3Q0FBOEI7O0lBQzlCLDhDQUFvQzs7SUFDcEMsNENBQWlDOztJQUNqQyxzREFBNEM7O0lBQzVDLHNEQUE0Qzs7SUFDNUMsK0NBQXNDOztJQUN0Qyx1Q0FBdUY7O0lBS3ZGLDZDQUF1RDs7SUFFdkQsMENBQWlDOztJQUNqQyxxREFBK0M7O0lBQy9DLHNDQUFvQjs7SUFDcEIsdUNBQXFCOztJQUNyQix1Q0FBb0I7O0lBQ3BCLDhDQUE0Qjs7SUFDNUIscURBQWtDOztJQUNsQywwQ0FBbUI7O0lBQ25CLG9EQUFpQzs7SUFFakMsOENBQXVDOztJQUN2QywrQ0FBeUM7O0lBRXpDLGtEQUE0Qjs7SUFDNUIsa0RBQTRCOztJQUM1QixrREFBNEI7Ozs7O0lBUzVCLHNEQVNDOzs7OztJQU1XLDBDQUE2Qjs7Ozs7SUFDN0Isc0NBQWdDOzs7OztJQUNoQywyQ0FBNkIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRoaXMgaXMgYSBjb250aW51YXRpb24gb2Ygbmd4LXBvcG92ZXJcbiAqIEBSZWZlcmVuY2Uge2dpdGh1Yn0gaHR0cHM6Ly9naXRodWIuY29tL3BsZWVyb2NrL25neC1wb3BvdmVyXG4gKi9cblxuaW1wb3J0IHtcbiAgICBBZnRlclZpZXdJbml0LCBBcHBsaWNhdGlvblJlZixcbiAgICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBDb21wb25lbnQsIENvbXBvbmVudFJlZixcbiAgICBFbGVtZW50UmVmLCBFbWJlZGRlZFZpZXdSZWYsXG4gICAgRXZlbnRFbWl0dGVyLCBJbmplY3RvcixcbiAgICBJbnB1dCxcbiAgICBPbkRlc3Ryb3ksXG4gICAgUmVuZGVyZXIyLFxuICAgIFZpZXdDaGlsZCwgVmlld0NvbnRhaW5lclJlZixcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBQb3BvdmVyRGlyZWN0aXZlIH0gZnJvbSAnLi9wb3BvdmVyLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBQb3BvdmVyUGxhY2VtZW50IH0gZnJvbSAnLi9wb3BvdmVyLnBsYWNlbWVudCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3BvcG92ZXItY29udGVudCcsXG4gIHRlbXBsYXRlOiBgXG4gICAgPGRpdiAjcG9wb3ZlckRpdlxuICAgICAgICBjbGFzcz1cImJzLXBvcG92ZXIte3sgZWZmZWN0aXZlUGxhY2VtZW50IH19IHBvcG92ZXItY29udGVudCBwb3BvdmVyIHt7IHBhcmVudENsYXNzIH19XCJcbiAgICAgICAgW25nQ2xhc3NdPVwie1xuICAgICAgICAgICAgJ3NtJzogc2l6ZSA9PT0gJ3NtYWxsJyxcbiAgICAgICAgICAgICdtZC1zbSc6IHNpemUgPT09ICdtZWRpdW0tc21hbGwnLFxuICAgICAgICAgICAgJ21kJzogc2l6ZSA9PT0gJ21lZGl1bScsXG4gICAgICAgICAgICAnbGcnOiBzaXplID09PSAnbGFyZ2UnXG4gICAgICAgIH1cIlxuICAgICAgICBbc3R5bGUudG9wLnB4XT1cInRvcFwiXG4gICAgICAgIFtzdHlsZS5sZWZ0LnB4XT1cImxlZnRcIlxuICAgICAgICBbc3R5bGUudHJhbnNpdGlvbl09XCIodHJhbnNpdGlvbkVuYWJsZWQgPyAnMC4xNXMgb3BhY2l0eScgOiAnJylcIlxuICAgICAgICBbc3R5bGUub3BhY2l0eV09XCJvcGFjaXR5XCJcbiAgICAgICAgW3N0eWxlLmRpc3BsYXldPVwiJ2Jsb2NrJ1wiXG4gICAgICAgIFtjbGFzcy5pbl09XCJpc0luXCJcbiAgICAgICAgcm9sZT1cInBvcG92ZXJcIj5cbiAgICAgICAgICAgIDxkaXYgW2hpZGRlbl09XCIhY2xvc2VPbk1vdXNlT3V0c2lkZVwiIGNsYXNzPVwidmlydHVhbC1hcmVhXCI+PC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYXJyb3dcIj48L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJwb3BvdmVyLWhlYWRlclwiIFtoaWRkZW5dPVwiIXRpdGxlXCI+e3sgdGl0bGUgfX08L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJwb3BvdmVyLWJvZHlcIj5cbiAgICAgICAgICAgICAgICA8bmctY29udGVudD48L25nLWNvbnRlbnQ+XG4gICAgICAgICAgICAgICAge3sgY29udGVudCB9fVxuICAgICAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICAgYFxufSlcbmV4cG9ydCBjbGFzcyBQb3BvdmVyQ29udGVudENvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gSW5wdXRzIC8gT3V0cHV0c1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIEBJbnB1dCgpIHB1YmxpYyBjb250ZW50OiBzdHJpbmc7XG4gIEBJbnB1dCgpIHB1YmxpYyBwbGFjZW1lbnQ6IFBvcG92ZXJQbGFjZW1lbnQgPSBQb3BvdmVyUGxhY2VtZW50LlRvcDtcbiAgQElucHV0KCkgcHVibGljIHRpdGxlOiBzdHJpbmc7XG4gIEBJbnB1dCgpIHB1YmxpYyBwYXJlbnRDbGFzczogc3RyaW5nO1xuICBASW5wdXQoKSBwdWJsaWMgYW5pbWF0aW9uID0gdHJ1ZTtcbiAgQElucHV0KCkgcHVibGljIGNsb3NlT25DbGlja091dHNpZGUgPSBmYWxzZTtcbiAgQElucHV0KCkgcHVibGljIGNsb3NlT25Nb3VzZU91dHNpZGUgPSBmYWxzZTtcbiAgQElucHV0KCkgcHVibGljIGFwcGVuZFRvQm9keTogYm9vbGVhbjtcbiAgQElucHV0KCkgcHVibGljIHNpemU6ICdzbWFsbCcgfCAnbWVkaXVtLXNtYWxsJyB8ICdtZWRpdW0nIHwgJ2xhcmdlJyB8ICdhdXRvJyA9ICdzbWFsbCc7XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBQcm9wZXJ0aWVzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgQFZpZXdDaGlsZCgncG9wb3ZlckRpdicpIHB1YmxpYyBwb3BvdmVyRGl2OiBFbGVtZW50UmVmO1xuXG4gIHB1YmxpYyBwb3BvdmVyOiBQb3BvdmVyRGlyZWN0aXZlO1xuICBwdWJsaWMgb25DbG9zZUZyb21PdXRzaWRlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBwdWJsaWMgdG9wID0gLTEwMDAwO1xuICBwdWJsaWMgbGVmdCA9IC0xMDAwMDtcbiAgcHVibGljIGlzSW4gPSBmYWxzZTtcbiAgcHVibGljIGRpc3BsYXlUeXBlID0gJ25vbmUnO1xuICBwdWJsaWMgZWZmZWN0aXZlUGxhY2VtZW50OiBzdHJpbmc7XG4gIHB1YmxpYyBvcGFjaXR5ID0gMDtcbiAgcHVibGljIHRyYW5zaXRpb25FbmFibGVkID0gZmFsc2U7XG5cbiAgcHVibGljIHdpbmRvd1dpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XG4gIHB1YmxpYyB3aW5kb3dIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG5cbiAgcHVibGljIGxpc3RlbkNsaWNrRnVuYzogYW55O1xuICBwdWJsaWMgbGlzdGVuTW91c2VGdW5jOiBhbnk7XG4gIHB1YmxpYyBsaXN0ZW5Ub3VjaEZ1bmM6IGFueTtcblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIEFub255bW91c1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgLyoqXG4gICAqIENsb3NlcyBkcm9wZG93biBpZiB1c2VyIGNsaWNrcyBvdXRzaWRlIG9mIHRoaXMgZGlyZWN0aXZlLlxuICAgKi9cbiAgcHVibGljIG9uRG9jdW1lbnRNb3VzZURvd24gPSAoZXZlbnQ6IGFueSkgPT4ge1xuICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50O1xuICAgICAgaWYgKCFlbGVtZW50IHx8ICF0aGlzLnBvcG92ZXIpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoZWxlbWVudC5jb250YWlucyhldmVudC50YXJnZXQpIHx8IHRoaXMucG9wb3Zlci5nZXRFbGVtZW50KCkuY29udGFpbnMoZXZlbnQudGFyZ2V0KSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMub25DbG9zZUZyb21PdXRzaWRlLmVtaXQodW5kZWZpbmVkKTtcbiAgfVxuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gQ29uc3RydWN0b3JcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBlbGVtZW50OiBFbGVtZW50UmVmLFxuICAgICAgICAgICAgICBwcm90ZWN0ZWQgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICAgICAgICAgICAgcHJvdGVjdGVkIHJlbmRlcmVyOiBSZW5kZXJlcjIpIHtcbiAgfVxuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gTGlmZWN5Y2xlIGNhbGxiYWNrc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgcHVibGljIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcbiAgICAgIGlmICh0aGlzLmNsb3NlT25DbGlja091dHNpZGUpIHtcbiAgICAgICAgICB0aGlzLmxpc3RlbkNsaWNrRnVuYyA9IHRoaXMucmVuZGVyZXIubGlzdGVuKCdkb2N1bWVudCcsICdtb3VzZWRvd24nLCAoZXZlbnQ6IGFueSkgPT4gdGhpcy5vbkRvY3VtZW50TW91c2VEb3duKGV2ZW50KSk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5jbG9zZU9uTW91c2VPdXRzaWRlKSB7XG4gICAgICAgICAgdGhpcy5saXN0ZW5Nb3VzZUZ1bmMgPSB0aGlzLnJlbmRlcmVyLmxpc3RlbignZG9jdW1lbnQnLCAnbW91c2VvdmVyJywgKGV2ZW50OiBhbnkpID0+IHRoaXMub25Eb2N1bWVudE1vdXNlRG93bihldmVudCkpO1xuICAgICAgfVxuICAgICAgLy8gQWx3YXlzIGNsb3NlIG9uIG1vYmlsZSB0b3VjaCBldmVudCBvdXRzaWRlLlxuICAgICAgdGhpcy5saXN0ZW5Ub3VjaEZ1bmMgPSB0aGlzLnJlbmRlcmVyLmxpc3RlbignZG9jdW1lbnQnLCAndG91Y2hzdGFydCcsIChldmVudDogYW55KSA9PiB0aGlzLm9uRG9jdW1lbnRNb3VzZURvd24oZXZlbnQpKTtcblxuICAgICAgdGhpcy5zaG93KCk7XG4gICAgICB0aGlzLmNkci5kZXRlY3RDaGFuZ2VzKCk7XG4gIH1cblxuICBwdWJsaWMgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgICBpZiAodGhpcy5jbG9zZU9uQ2xpY2tPdXRzaWRlICYmIHRoaXMubGlzdGVuQ2xpY2tGdW5jKSB7XG4gICAgICAgICAgdGhpcy5saXN0ZW5DbGlja0Z1bmMoKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmNsb3NlT25Nb3VzZU91dHNpZGUgJiYgdGhpcy5saXN0ZW5Nb3VzZUZ1bmMpIHtcbiAgICAgICAgICB0aGlzLmxpc3Rlbk1vdXNlRnVuYygpO1xuICAgICAgfVxuICAgICAgaWYgKCEhdGhpcy5saXN0ZW5Ub3VjaEZ1bmMpIHtcbiAgICAgICAgICB0aGlzLmxpc3RlblRvdWNoRnVuYygpO1xuICAgICAgfVxuICB9XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBQdWJsaWMgTWV0aG9kc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgcHVibGljIHVwZGF0ZVBvc2l0aW9uKCk6IHZvaWQge1xuICAgICAgLy8gaWYgdmlzaWJsZSwgcmVwb3NpdGlvblxuICAgICAgaWYgKHRoaXMub3BhY2l0eSkge1xuICAgICAgICAgIGNvbnN0IHAgPSB0aGlzLnBvc2l0aW9uRWxlbWVudHModGhpcy5wb3BvdmVyLmdldEVsZW1lbnQoKSwgdGhpcy5wb3BvdmVyRGl2Lm5hdGl2ZUVsZW1lbnQsIHRoaXMucGxhY2VtZW50LCB0aGlzLmFwcGVuZFRvQm9keSk7XG4gICAgICAgICAgdGhpcy50b3AgPSBwLnRvcDtcbiAgICAgICAgICB0aGlzLmxlZnQgPSBwLmxlZnQ7XG4gICAgICB9XG4gIH1cblxuICBwdWJsaWMgc2hvdygpOiB2b2lkIHtcbiAgICAgIGlmICghdGhpcy5wb3BvdmVyIHx8ICF0aGlzLnBvcG92ZXIuZ2V0RWxlbWVudCgpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBwID0gdGhpcy5wb3NpdGlvbkVsZW1lbnRzKHRoaXMucG9wb3Zlci5nZXRFbGVtZW50KCksIHRoaXMucG9wb3ZlckRpdi5uYXRpdmVFbGVtZW50LCB0aGlzLnBsYWNlbWVudCwgdGhpcy5hcHBlbmRUb0JvZHkpO1xuICAgICAgdGhpcy5kaXNwbGF5VHlwZSA9ICdibG9jayc7XG4gICAgICB0aGlzLnRvcCA9IHAudG9wO1xuICAgICAgdGhpcy5sZWZ0ID0gcC5sZWZ0O1xuICAgICAgdGhpcy5pc0luID0gdHJ1ZTtcbiAgICAgIHRoaXMudHJhbnNpdGlvbkVuYWJsZWQgPSB0cnVlO1xuICAgICAgdGhpcy5vcGFjaXR5ID0gMTtcbiAgfVxuXG4gIHB1YmxpYyBoaWRlKCk6IHZvaWQge1xuICAgICAgdGhpcy50b3AgPSAtMTAwMDA7XG4gICAgICB0aGlzLmxlZnQgPSAtMTAwMDA7XG4gICAgICB0aGlzLmlzSW4gPSB0cnVlO1xuICAgICAgdGhpcy5wb3BvdmVyLmhpZGUoKTtcbiAgfVxuXG4gIHB1YmxpYyBoaWRlRnJvbVBvcG92ZXIoKTogdm9pZCB7XG4gICAgICB0aGlzLnRvcCA9IC0xMDAwMDtcbiAgICAgIHRoaXMubGVmdCA9IC0xMDAwMDtcbiAgICAgIHRoaXMuaXNJbiA9IHRydWU7XG4gICAgICB0aGlzLnRyYW5zaXRpb25FbmFibGVkID0gZmFsc2U7XG4gICAgICB0aGlzLm9wYWNpdHkgPSAwO1xuICB9XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBQcm90ZWN0ZWQgTWV0aG9kc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgcHJvdGVjdGVkIHBvc2l0aW9uRWxlbWVudHMoaG9zdEVsOiBIVE1MRWxlbWVudCwgdGFyZ2V0RWw6IEhUTUxFbGVtZW50LCBwb3NpdGlvblN0cjogUG9wb3ZlclBsYWNlbWVudCwgYXBwZW5kVG9Cb2R5OiBib29sZWFuID0gZmFsc2UpOiB7IHRvcDogbnVtYmVyLCBsZWZ0OiBudW1iZXIgfSB7XG4gICAgICBjb25zdCBwb3NpdGlvblN0clBhcnRzID0gKHBvc2l0aW9uU3RyIGFzIHN0cmluZykuc3BsaXQoJyAnKTtcbiAgICAgIGxldCBwb3MwID0gcG9zaXRpb25TdHJQYXJ0c1swXTtcbiAgICAgIGNvbnN0IHBvczEgPSBwb3NpdGlvblN0clBhcnRzWzFdIHx8ICdjZW50ZXInO1xuICAgICAgY29uc3QgaG9zdEVsUG9zID0gYXBwZW5kVG9Cb2R5ID8gdGhpcy5vZmZzZXQoaG9zdEVsKSA6IHRoaXMucG9zaXRpb24oaG9zdEVsKTtcbiAgICAgIGNvbnN0IHRhcmdldEVsV2lkdGggPSB0YXJnZXRFbC5vZmZzZXRXaWR0aDtcbiAgICAgIGNvbnN0IHRhcmdldEVsSGVpZ2h0ID0gdGFyZ2V0RWwub2Zmc2V0SGVpZ2h0O1xuXG4gICAgICB0aGlzLmVmZmVjdGl2ZVBsYWNlbWVudCA9IHBvczAgPSB0aGlzLmdldEVmZmVjdGl2ZVBsYWNlbWVudChwb3MwLCBob3N0RWwsIHRhcmdldEVsKTtcblxuICAgICAgY29uc3Qgc2hpZnRXaWR0aDogYW55ID0ge1xuICAgICAgICAgIGNlbnRlcjogZnVuY3Rpb24gKCk6IG51bWJlciB7XG4gICAgICAgICAgICAgIHJldHVybiBob3N0RWxQb3MubGVmdCArIGhvc3RFbFBvcy53aWR0aCAvIDIgLSB0YXJnZXRFbFdpZHRoIC8gMjtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGxlZnQ6IGZ1bmN0aW9uICgpOiBudW1iZXIge1xuICAgICAgICAgICAgICByZXR1cm4gaG9zdEVsUG9zLmxlZnQ7XG4gICAgICAgICAgfSxcbiAgICAgICAgICByaWdodDogZnVuY3Rpb24gKCk6IG51bWJlciB7XG4gICAgICAgICAgICAgIHJldHVybiBob3N0RWxQb3MubGVmdCArIGhvc3RFbFBvcy53aWR0aDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHRvcE9yQm90dG9tUmlnaHQ6IGZ1bmN0aW9uICgpOiBudW1iZXIge1xuICAgICAgICAgICAgICByZXR1cm4gaG9zdEVsUG9zLmxlZnQgKyBob3N0RWxQb3Mud2lkdGggLyAyO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdG9wT3JCb3R0b21MZWZ0OiBmdW5jdGlvbiAoKTogbnVtYmVyIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGhvc3RFbFBvcy5sZWZ0IC0gdGFyZ2V0RWxXaWR0aCAgKyBob3N0RWxQb3Mud2lkdGggLyAyO1xuICAgICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHNoaWZ0SGVpZ2h0OiBhbnkgPSB7XG4gICAgICAgICAgY2VudGVyOiBmdW5jdGlvbiAoKTogbnVtYmVyIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGhvc3RFbFBvcy50b3AgKyBob3N0RWxQb3MuaGVpZ2h0IC8gMiAtIHRhcmdldEVsSGVpZ2h0IC8gMjtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHRvcDogZnVuY3Rpb24gKCk6IG51bWJlciB7XG4gICAgICAgICAgICAgIHJldHVybiBob3N0RWxQb3MudG9wO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgYm90dG9tOiBmdW5jdGlvbiAoKTogbnVtYmVyIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGhvc3RFbFBvcy50b3AgKyBob3N0RWxQb3MuaGVpZ2h0O1xuICAgICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIGxldCB0YXJnZXRFbFBvczogeyB0b3A6IG51bWJlciwgbGVmdDogbnVtYmVyIH07XG4gICAgICBzd2l0Y2ggKHBvczApIHtcbiAgICAgICAgICBjYXNlIFBvcG92ZXJQbGFjZW1lbnQuUmlnaHQ6XG4gICAgICAgICAgICAgIHRhcmdldEVsUG9zID0ge1xuICAgICAgICAgICAgICAgICAgdG9wOiBzaGlmdEhlaWdodFtwb3MxXSgpLFxuICAgICAgICAgICAgICAgICAgbGVmdDogc2hpZnRXaWR0aFtwb3MwXSgpXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSBQb3BvdmVyUGxhY2VtZW50LkxlZnQ6XG4gICAgICAgICAgICAgIHRhcmdldEVsUG9zID0ge1xuICAgICAgICAgICAgICAgICAgdG9wOiBzaGlmdEhlaWdodFtwb3MxXSgpLFxuICAgICAgICAgICAgICAgICAgbGVmdDogaG9zdEVsUG9zLmxlZnQgLSB0YXJnZXRFbFdpZHRoXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSBQb3BvdmVyUGxhY2VtZW50LkJvdHRvbTpcbiAgICAgICAgICAgICAgdGFyZ2V0RWxQb3MgPSB7XG4gICAgICAgICAgICAgICAgICB0b3A6IHNoaWZ0SGVpZ2h0W3BvczBdKCksXG4gICAgICAgICAgICAgICAgICBsZWZ0OiBzaGlmdFdpZHRoW3BvczFdKClcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBQb3BvdmVyUGxhY2VtZW50LlRvcExlZnQ6XG4gICAgICAgICAgICAgIHRhcmdldEVsUG9zID0ge1xuICAgICAgICAgICAgICAgICAgdG9wOiBob3N0RWxQb3MudG9wIC0gdGFyZ2V0RWxIZWlnaHQsXG4gICAgICAgICAgICAgICAgICBsZWZ0OiBzaGlmdFdpZHRoWyd0b3BPckJvdHRvbUxlZnQnXSgpXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgUG9wb3ZlclBsYWNlbWVudC5Ub3BSaWdodDpcbiAgICAgICAgICAgICAgdGFyZ2V0RWxQb3MgPSB7XG4gICAgICAgICAgICAgICAgICB0b3A6IGhvc3RFbFBvcy50b3AgLSB0YXJnZXRFbEhlaWdodCxcbiAgICAgICAgICAgICAgICAgIGxlZnQ6IHNoaWZ0V2lkdGhbJ3RvcE9yQm90dG9tUmlnaHQnXSgpXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgUG9wb3ZlclBsYWNlbWVudC5Cb3R0b21MZWZ0OlxuICAgICAgICAgICAgICB0YXJnZXRFbFBvcyA9IHtcbiAgICAgICAgICAgICAgICAgIHRvcDogc2hpZnRIZWlnaHRbUG9wb3ZlclBsYWNlbWVudC5Cb3R0b21dKCksXG4gICAgICAgICAgICAgICAgICBsZWZ0OiBzaGlmdFdpZHRoWyd0b3BPckJvdHRvbUxlZnQnXSgpXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgUG9wb3ZlclBsYWNlbWVudC5Cb3R0b21SaWdodDpcbiAgICAgICAgICAgICAgdGFyZ2V0RWxQb3MgPSB7XG4gICAgICAgICAgICAgICAgICB0b3A6IHNoaWZ0SGVpZ2h0W1BvcG92ZXJQbGFjZW1lbnQuQm90dG9tXSgpLFxuICAgICAgICAgICAgICAgICAgbGVmdDogc2hpZnRXaWR0aFsndG9wT3JCb3R0b21SaWdodCddKClcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICB0YXJnZXRFbFBvcyA9IHtcbiAgICAgICAgICAgICAgICAgIHRvcDogaG9zdEVsUG9zLnRvcCAtIHRhcmdldEVsSGVpZ2h0LFxuICAgICAgICAgICAgICAgICAgbGVmdDogc2hpZnRXaWR0aFtwb3MxXSgpXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGFyZ2V0RWxQb3M7XG4gIH1cblxuICBwcm90ZWN0ZWQgcG9zaXRpb24obmF0aXZlRWw6IEhUTUxFbGVtZW50KTogeyB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlciwgdG9wOiBudW1iZXIsIGxlZnQ6IG51bWJlciB9IHtcbiAgICAgIGxldCBvZmZzZXRQYXJlbnRCQ1IgPSB7IHRvcDogMCwgbGVmdDogMCB9O1xuICAgICAgY29uc3QgZWxCQ1IgPSB0aGlzLm9mZnNldChuYXRpdmVFbCk7XG4gICAgICBjb25zdCBvZmZzZXRQYXJlbnRFbCA9IHRoaXMucGFyZW50T2Zmc2V0RWwobmF0aXZlRWwpO1xuICAgICAgaWYgKG9mZnNldFBhcmVudEVsICE9PSB3aW5kb3cuZG9jdW1lbnQpIHtcbiAgICAgICAgICBvZmZzZXRQYXJlbnRCQ1IgPSB0aGlzLm9mZnNldChvZmZzZXRQYXJlbnRFbCk7XG4gICAgICAgICAgb2Zmc2V0UGFyZW50QkNSLnRvcCArPSBvZmZzZXRQYXJlbnRFbC5jbGllbnRUb3AgLSBvZmZzZXRQYXJlbnRFbC5zY3JvbGxUb3A7XG4gICAgICAgICAgb2Zmc2V0UGFyZW50QkNSLmxlZnQgKz0gb2Zmc2V0UGFyZW50RWwuY2xpZW50TGVmdCAtIG9mZnNldFBhcmVudEVsLnNjcm9sbExlZnQ7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGJvdW5kaW5nQ2xpZW50UmVjdCA9IG5hdGl2ZUVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB3aWR0aDogYm91bmRpbmdDbGllbnRSZWN0LndpZHRoIHx8IG5hdGl2ZUVsLm9mZnNldFdpZHRoLFxuICAgICAgICAgIGhlaWdodDogYm91bmRpbmdDbGllbnRSZWN0LmhlaWdodCB8fCBuYXRpdmVFbC5vZmZzZXRIZWlnaHQsXG4gICAgICAgICAgdG9wOiBlbEJDUi50b3AgLSBvZmZzZXRQYXJlbnRCQ1IudG9wLFxuICAgICAgICAgIGxlZnQ6IGVsQkNSLmxlZnQgLSBvZmZzZXRQYXJlbnRCQ1IubGVmdFxuICAgICAgfTtcbiAgfVxuXG4gIHByb3RlY3RlZCBvZmZzZXQobmF0aXZlRWw6IGFueSk6IHsgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIsIHRvcDogbnVtYmVyLCBsZWZ0OiBudW1iZXIgfSB7XG4gICAgICBjb25zdCBib3VuZGluZ0NsaWVudFJlY3QgPSBuYXRpdmVFbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgICAgd2lkdGg6IGJvdW5kaW5nQ2xpZW50UmVjdC53aWR0aCB8fCBuYXRpdmVFbC5vZmZzZXRXaWR0aCxcbiAgICAgICAgICBoZWlnaHQ6IGJvdW5kaW5nQ2xpZW50UmVjdC5oZWlnaHQgfHwgbmF0aXZlRWwub2Zmc2V0SGVpZ2h0LFxuICAgICAgICAgIHRvcDogYm91bmRpbmdDbGllbnRSZWN0LnRvcCArICh3aW5kb3cucGFnZVlPZmZzZXQgfHwgd2luZG93LmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3ApLFxuICAgICAgICAgIGxlZnQ6IGJvdW5kaW5nQ2xpZW50UmVjdC5sZWZ0ICsgKHdpbmRvdy5wYWdlWE9mZnNldCB8fCB3aW5kb3cuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbExlZnQpXG4gICAgICB9O1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldFN0eWxlKG5hdGl2ZUVsOiBIVE1MRWxlbWVudCwgY3NzUHJvcDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgIGlmICgobmF0aXZlRWwgYXMgYW55KS5jdXJyZW50U3R5bGUpIHsgLy8gSUVcbiAgICAgICAgICByZXR1cm4gKG5hdGl2ZUVsIGFzIGFueSkuY3VycmVudFN0eWxlW2Nzc1Byb3BdO1xuICAgICAgfVxuXG4gICAgICBpZiAod2luZG93LmdldENvbXB1dGVkU3R5bGUpIHtcbiAgICAgICAgICByZXR1cm4gKHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlIGFzIGFueSkobmF0aXZlRWwpW2Nzc1Byb3BdO1xuICAgICAgfVxuXG4gICAgICAvLyBmaW5hbGx5IHRyeSBhbmQgZ2V0IGlubGluZSBzdHlsZVxuICAgICAgcmV0dXJuIChuYXRpdmVFbC5zdHlsZSBhcyBhbnkpW2Nzc1Byb3BdO1xuICB9XG5cbiAgcHJvdGVjdGVkIGlzU3RhdGljUG9zaXRpb25lZChuYXRpdmVFbDogSFRNTEVsZW1lbnQpOiBib29sZWFuIHtcbiAgICAgIHJldHVybiAodGhpcy5nZXRTdHlsZShuYXRpdmVFbCwgJ3Bvc2l0aW9uJykgfHwgJ3N0YXRpYycgKSA9PT0gJ3N0YXRpYyc7XG4gIH1cblxuICBwcm90ZWN0ZWQgcGFyZW50T2Zmc2V0RWwobmF0aXZlRWw6IEhUTUxFbGVtZW50KTogYW55IHtcbiAgICAgIGxldCBvZmZzZXRQYXJlbnQ6IGFueSA9IG5hdGl2ZUVsLm9mZnNldFBhcmVudCB8fCB3aW5kb3cuZG9jdW1lbnQ7XG4gICAgICB3aGlsZSAob2Zmc2V0UGFyZW50ICYmIG9mZnNldFBhcmVudCAhPT0gd2luZG93LmRvY3VtZW50ICYmIHRoaXMuaXNTdGF0aWNQb3NpdGlvbmVkKG9mZnNldFBhcmVudCkpIHtcbiAgICAgICAgICBvZmZzZXRQYXJlbnQgPSBvZmZzZXRQYXJlbnQub2Zmc2V0UGFyZW50O1xuICAgICAgfVxuICAgICAgcmV0dXJuIG9mZnNldFBhcmVudCB8fCB3aW5kb3cuZG9jdW1lbnQ7XG4gIH1cblxuICAvLyBDaGVjayBmb3Igb3ZlcmZsb3cgb2YgdGhlIHZpZXdwb3J0IGFuZCByZWZsZWN0IHRoZSBwb3NpdGlvbiBpZiBuZWNlc3NhcnkuXG4gIHByb3RlY3RlZCBnZXRFZmZlY3RpdmVQbGFjZW1lbnQocGxhY2VtZW50OiBzdHJpbmcsIGhvc3RFbGVtZW50OiBIVE1MRWxlbWVudCwgdGFyZ2V0RWxlbWVudDogSFRNTEVsZW1lbnQpOiBzdHJpbmcge1xuICAgICAgY29uc3QgaG9zdEVsQm91bmRpbmdSZWN0ID0gaG9zdEVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICAgIGNvbnN0IGRlc2lyZWRQbGFjZW1lbnQgPSBwbGFjZW1lbnQgfHwgUG9wb3ZlclBsYWNlbWVudC5Ub3A7XG5cbiAgICAgIC8vIFJlZmxlY3QgYXBwcm9wcmlhdGVseSBpZiBvdmVyZmxvdy5cbiAgICAgIGlmIChkZXNpcmVkUGxhY2VtZW50ID09PSBQb3BvdmVyUGxhY2VtZW50LlRvcCkge1xuICAgICAgICAgIGNvbnN0IGlzVG9wT3ZlcmZsb3cgPSBob3N0RWxCb3VuZGluZ1JlY3QudG9wIC0gdGFyZ2V0RWxlbWVudC5vZmZzZXRIZWlnaHQgPCAwO1xuICAgICAgICAgIGNvbnN0IGlzUmlnaHRPdmVyZmxvdyA9IGhvc3RFbEJvdW5kaW5nUmVjdC5sZWZ0ICsgaG9zdEVsQm91bmRpbmdSZWN0LndpZHRoIC8gMiArIHRhcmdldEVsZW1lbnQub2Zmc2V0V2lkdGggLyAyID4gdGhpcy53aW5kb3dXaWR0aDtcbiAgICAgICAgICBjb25zdCBpc0xlZnRPdmVyZmxvdyA9IGhvc3RFbEJvdW5kaW5nUmVjdC5sZWZ0ICsgaG9zdEVsQm91bmRpbmdSZWN0LndpZHRoIC8gMiAtIHRhcmdldEVsZW1lbnQub2Zmc2V0V2lkdGggLyAyIDwgMDtcblxuICAgICAgICAgIGlmIChpc1RvcE92ZXJmbG93KSB7XG4gICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LkJvdHRvbTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGlzUmlnaHRPdmVyZmxvdykge1xuICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5Ub3BMZWZ0O1xuICAgICAgICAgIH0gZWxzZSBpZiAoaXNMZWZ0T3ZlcmZsb3cpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuVG9wUmlnaHQ7XG4gICAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGRlc2lyZWRQbGFjZW1lbnQgPT09IFBvcG92ZXJQbGFjZW1lbnQuQm90dG9tKSB7XG4gICAgICAgICAgY29uc3QgaXNSaWdodE92ZXJmbG93ID0gaG9zdEVsQm91bmRpbmdSZWN0LmxlZnQgKyBob3N0RWxCb3VuZGluZ1JlY3Qud2lkdGggLyAyICsgdGFyZ2V0RWxlbWVudC5vZmZzZXRXaWR0aCAvIDIgPiB0aGlzLndpbmRvd1dpZHRoO1xuICAgICAgICAgIGNvbnN0IGlzTGVmdE92ZXJmbG93ID0gaG9zdEVsQm91bmRpbmdSZWN0LmxlZnQgKyBob3N0RWxCb3VuZGluZ1JlY3Qud2lkdGggLyAyIC0gdGFyZ2V0RWxlbWVudC5vZmZzZXRXaWR0aCAvIDIgPCAwO1xuICAgICAgICAgIGNvbnN0IGlzQm90dG9tT3ZlcmZsb3cgPSBob3N0RWxCb3VuZGluZ1JlY3QuYm90dG9tICsgdGFyZ2V0RWxlbWVudC5vZmZzZXRIZWlnaHQgPiB0aGlzLndpbmRvd0hlaWdodDtcblxuICAgICAgICAgIGlmIChpc0JvdHRvbU92ZXJmbG93KSB7XG4gICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LlRvcDtcbiAgICAgICAgICB9IGVsc2UgaWYgKGlzUmlnaHRPdmVyZmxvdykge1xuICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5Cb3R0b21MZWZ0O1xuICAgICAgICAgIH0gZWxzZSBpZiAoaXNMZWZ0T3ZlcmZsb3cpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuQm90dG9tUmlnaHQ7XG4gICAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGRlc2lyZWRQbGFjZW1lbnQgPT09IFBvcG92ZXJQbGFjZW1lbnQuTGVmdCkge1xuICAgICAgICAgIGNvbnN0IGlzVG9wT3ZlcmZsb3cgPSBob3N0RWxCb3VuZGluZ1JlY3QudG9wICsgaG9zdEVsQm91bmRpbmdSZWN0LmhlaWdodCAvIDIgLSB0YXJnZXRFbGVtZW50Lm9mZnNldEhlaWdodCAvIDIgPCAwO1xuICAgICAgICAgIGNvbnN0IGlzTGVmdE92ZXJmbG93ID0gaG9zdEVsQm91bmRpbmdSZWN0LmxlZnQgLSB0YXJnZXRFbGVtZW50Lm9mZnNldFdpZHRoIDwgMDtcbiAgICAgICAgICBjb25zdCBpc0JvdHRvbU92ZXJmbG93ID0gaG9zdEVsQm91bmRpbmdSZWN0LnRvcCArIGhvc3RFbEJvdW5kaW5nUmVjdC5oZWlnaHQgLyAyICsgdGFyZ2V0RWxlbWVudC5vZmZzZXRIZWlnaHQgLyAyID4gdGhpcy53aW5kb3dIZWlnaHQ7XG5cbiAgICAgICAgICBpZiAoaXNMZWZ0T3ZlcmZsb3cpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuUmlnaHQ7XG4gICAgICAgICAgfSBlbHNlIGlmIChpc1RvcE92ZXJmbG93KSB7XG4gICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LkJvdHRvbUxlZnQ7XG4gICAgICAgICAgfSBlbHNlIGlmIChpc0JvdHRvbU92ZXJmbG93KSB7XG4gICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LlRvcExlZnQ7XG4gICAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGRlc2lyZWRQbGFjZW1lbnQgPT09IFBvcG92ZXJQbGFjZW1lbnQuUmlnaHQpIHtcbiAgICAgICAgICBjb25zdCBpc1RvcE92ZXJmbG93ID0gaG9zdEVsQm91bmRpbmdSZWN0LnRvcCArIGhvc3RFbEJvdW5kaW5nUmVjdC5oZWlnaHQgLyAyIC0gdGFyZ2V0RWxlbWVudC5vZmZzZXRIZWlnaHQgLyAyIDwgMDtcbiAgICAgICAgICBjb25zdCBpc1JpZ2h0T3ZlcmZsb3cgPSBob3N0RWxCb3VuZGluZ1JlY3QucmlnaHQgKyB0YXJnZXRFbGVtZW50Lm9mZnNldFdpZHRoID4gdGhpcy53aW5kb3dXaWR0aDtcbiAgICAgICAgICBjb25zdCBpc0JvdHRvbU92ZXJmbG93ID0gaG9zdEVsQm91bmRpbmdSZWN0LnRvcCArIGhvc3RFbEJvdW5kaW5nUmVjdC5oZWlnaHQgLyAyICsgdGFyZ2V0RWxlbWVudC5vZmZzZXRIZWlnaHQgLyAyID4gdGhpcy53aW5kb3dIZWlnaHQ7XG5cbiAgICAgICAgICBpZiAoaXNSaWdodE92ZXJmbG93KSB7XG4gICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LkxlZnQ7XG4gICAgICAgICAgfSBlbHNlIGlmIChpc1RvcE92ZXJmbG93KSB7XG4gICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LkJvdHRvbVJpZ2h0O1xuICAgICAgICAgIH0gZWxzZSBpZiAoaXNCb3R0b21PdmVyZmxvdykge1xuICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5Ub3BSaWdodDtcbiAgICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoZGVzaXJlZFBsYWNlbWVudCA9PT0gUG9wb3ZlclBsYWNlbWVudC5Ub3BSaWdodCkge1xuICAgICAgICAgIGNvbnN0IGlzVG9wT3ZlcmZsb3cgPSBob3N0RWxCb3VuZGluZ1JlY3QudG9wIC0gdGFyZ2V0RWxlbWVudC5vZmZzZXRIZWlnaHQgPCAwO1xuICAgICAgICAgIGNvbnN0IGlzUmlnaHRPdmVyZmxvdyA9IGhvc3RFbEJvdW5kaW5nUmVjdC5yaWdodCArIHRhcmdldEVsZW1lbnQub2Zmc2V0V2lkdGggPiB0aGlzLndpbmRvd1dpZHRoO1xuXG4gICAgICAgICAgaWYgKGlzVG9wT3ZlcmZsb3cgJiYgaXNSaWdodE92ZXJmbG93KSB7XG4gICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LkJvdHRvbUxlZnQ7XG4gICAgICAgICAgfSBlbHNlIGlmIChpc1RvcE92ZXJmbG93KSB7XG4gICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LkJvdHRvbVJpZ2h0O1xuICAgICAgICAgIH0gZWxzZSBpZiAoaXNSaWdodE92ZXJmbG93KSB7XG4gICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LlRvcExlZnQ7XG4gICAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGRlc2lyZWRQbGFjZW1lbnQgPT09IFBvcG92ZXJQbGFjZW1lbnQuVG9wTGVmdCkge1xuICAgICAgICAgIGNvbnN0IGlzVG9wT3ZlcmZsb3cgPSBob3N0RWxCb3VuZGluZ1JlY3QudG9wIC0gdGFyZ2V0RWxlbWVudC5vZmZzZXRIZWlnaHQgPCAwO1xuICAgICAgICAgIGNvbnN0IGlzTGVmdE92ZXJmbG93ID0gaG9zdEVsQm91bmRpbmdSZWN0LmxlZnQgLSB0YXJnZXRFbGVtZW50Lm9mZnNldFdpZHRoIDwgMDtcblxuICAgICAgICAgIGlmIChpc1RvcE92ZXJmbG93ICYmIGlzTGVmdE92ZXJmbG93KSB7XG4gICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LkJvdHRvbVJpZ2h0O1xuICAgICAgICAgIH0gZWxzZSBpZiAoaXNUb3BPdmVyZmxvdykge1xuICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5Cb3R0b21MZWZ0O1xuICAgICAgICAgIH0gZWxzZSBpZiAoaXNMZWZ0T3ZlcmZsb3cpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuVG9wUmlnaHQ7XG4gICAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGRlc2lyZWRQbGFjZW1lbnQgPT09IFBvcG92ZXJQbGFjZW1lbnQuQm90dG9tUmlnaHQpIHtcbiAgICAgICAgICBjb25zdCBpc0JvdHRvbU92ZXJmbG93ID0gaG9zdEVsQm91bmRpbmdSZWN0LmJvdHRvbSArIHRhcmdldEVsZW1lbnQub2Zmc2V0SGVpZ2h0ID4gdGhpcy53aW5kb3dIZWlnaHQ7XG4gICAgICAgICAgY29uc3QgaXNSaWdodE92ZXJmbG93ID0gaG9zdEVsQm91bmRpbmdSZWN0LnJpZ2h0ICsgdGFyZ2V0RWxlbWVudC5vZmZzZXRXaWR0aCA+IHRoaXMud2luZG93V2lkdGg7XG5cbiAgICAgICAgICBpZiAoaXNCb3R0b21PdmVyZmxvdyAmJiBpc1JpZ2h0T3ZlcmZsb3cpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuVG9wTGVmdDtcbiAgICAgICAgICB9IGVsc2UgaWYgKGlzQm90dG9tT3ZlcmZsb3cpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuVG9wUmlnaHQ7XG4gICAgICAgICAgfSBlbHNlIGlmIChpc1JpZ2h0T3ZlcmZsb3cpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuQm90dG9tTGVmdDtcbiAgICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoZGVzaXJlZFBsYWNlbWVudCA9PT0gUG9wb3ZlclBsYWNlbWVudC5Cb3R0b21MZWZ0KSB7XG4gICAgICAgICAgY29uc3QgaXNCb3R0b21PdmVyZmxvdyA9IGhvc3RFbEJvdW5kaW5nUmVjdC5ib3R0b20gKyB0YXJnZXRFbGVtZW50Lm9mZnNldEhlaWdodCA+IHRoaXMud2luZG93SGVpZ2h0O1xuICAgICAgICAgIGNvbnN0IGlzTGVmdE92ZXJmbG93ID0gaG9zdEVsQm91bmRpbmdSZWN0LmxlZnQgLSB0YXJnZXRFbGVtZW50Lm9mZnNldFdpZHRoIDwgMDtcblxuICAgICAgICAgIGlmIChpc0JvdHRvbU92ZXJmbG93ICYmIGlzTGVmdE92ZXJmbG93KSB7XG4gICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LlRvcFJpZ2h0O1xuICAgICAgICAgIH0gZWxzZSBpZiAoaXNCb3R0b21PdmVyZmxvdykge1xuICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5Ub3BMZWZ0O1xuICAgICAgICAgIH0gZWxzZSBpZiAoaXNMZWZ0T3ZlcmZsb3cpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuQm90dG9tUmlnaHQ7XG4gICAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gZGVzaXJlZFBsYWNlbWVudDtcbiAgfVxufVxuIl19